count(word, sort = TRUE) %>%
top_n(10) %>%
ungroup() %>%
mutate(book = factor(book, levels = titles),
text_order = factor(nrow(.):1)) %>%
ggplot(aes(text_order, n, fill = book)) +
geom_bar(stat = "identity") +
facet_wrap(~ book, scales = "free_y") +
scale_x_discrete(values = word) +
coord_flip() +
theme(legend.position="none")
# top 10 most common words in each book
series %>%
anti_join(stop_words) %>%
group_by(book) %>%
count(word, sort = TRUE) %>%
top_n(10) %>%
ungroup() %>%
mutate(book = factor(book, levels = titles),
text_order = factor(nrow(.):1)) %>%
ggplot(aes(text_order, n, fill = book)) +
geom_bar(stat = "identity") +
facet_wrap(~ book, scales = "free_y") +
scale_x_discrete(limits = word) +
coord_flip() +
theme(legend.position="none")
# top 10 most common words in each book
series %>%
anti_join(stop_words) %>%
group_by(book) %>%
count(word, sort = TRUE) %>%
top_n(10) %>%
ungroup() %>%
mutate(book = factor(book, levels = titles),
text_order = factor(nrow(.):1)) %>%
ggplot(aes(text_order, n, fill = book)) +
geom_bar(stat = "identity") +
facet_wrap(~ book, scales = "free_y") +
scale_x_discrete(label_value = word) +
coord_flip() +
theme(legend.position="none")
?label_value
# top 10 most common words in each book
series %>%
anti_join(stop_words) %>%
group_by(book) %>%
count(word, sort = TRUE) %>%
top_n(10) %>%
ungroup() %>%
mutate(book = factor(book, levels = titles),
text_order = nrow(.):1) %>%
ggplot(aes(reorder(word, text_order), n, fill = book)) +
geom_bar(stat = "identity") +
facet_wrap(~ book, scales = "free_y") +
coord_flip() +
theme(legend.position="none")
?bind_rows
series %>%
mutate(word = str_extract(word, "[a-z]+")) %>%
count(word) %>%
transmute(word, all_words = n / sum(n))
series %>%
anti_join(stop_words) %>%
mutate(word = str_extract(word, "[a-z]+")) %>%
count(word) %>%
transmute(word, all_words = n / sum(n))
potter_pct <- series %>%
anti_join(stop_words) %>%
mutate(word = str_extract(word, "[a-z]+")) %>%
count(word) %>%
transmute(word, all_words = n / sum(n))
series %>%
anti_join(stop_words) %>%
mutate(word = str_extract(word, "[a-z]+")) %>%
count(book, word) %>%
mutate(other = n / sum(n)) %>%
left_join(potter_pct) %>%
ungroup()
# calculate percent of word use across all novels
potter_pct <- series %>%
anti_join(stop_words) %>%
mutate(word = str_extract(word, "[a-z]+")) %>%
count(word) %>%
transmute(word, all_words = n / sum(n))
frequency <- series %>%
anti_join(stop_words) %>%
mutate(word = str_extract(word, "[a-z]+")) %>%
count(book, word) %>%
mutate(book_words = n / sum(n)) %>%
left_join(potter_pct) %>%
arrange(desc(book_words)) %>%
ungroup()
frequency
# calculate percent of word use across all novels
potter_pct <- series %>%
anti_join(stop_words) %>%
#mutate(word = str_extract(word, "[a-z]+")) %>%
count(word) %>%
transmute(word, all_words = n / sum(n))
frequency <- series %>%
anti_join(stop_words) %>%
#mutate(word = str_extract(word, "[a-z]+")) %>%
count(book, word) %>%
mutate(book_words = n / sum(n)) %>%
left_join(potter_pct) %>%
arrange(desc(book_words)) %>%
ungroup()
frequency
# calculate percent of word use across all novels
potter_pct <- series %>%
anti_join(stop_words) %>%
#mutate(word = str_extract(word, "[a-z]+")) %>%
count(word) %>%
transmute(word, all_words = n / sum(n))
frequency <- series %>%
anti_join(stop_words) %>%
#mutate(word = str_extract(word, "[a-z]+")) %>%
count(book, word) %>%
mutate(book_words = n / sum(n)) %>%
left_join(potter_pct) %>%
arrange(desc(book_words)) %>%
ungroup()
frequency
ggplot(frequency, aes(x = book_words, y = all_words, color = abs(all_words - book_words))) +
geom_abline(color = "gray40", lty = 2) +
geom_jitter(alpha = 0.1, size = 2.5, width = 0.3, height = 0.3) +
geom_text(aes(label = word), check_overlap = TRUE, vjust = 1.5) +
scale_x_log10(labels = percent_format()) +
scale_y_log10(labels = percent_format()) +
scale_color_gradient(limits = c(0, 0.001), low = "darkslategray4", high = "gray75") +
facet_wrap(~ book) +
theme(legend.position="none") +
labs(y = "Harry Potter Series", x = NULL)
ggplot(frequency, aes(x = book_words, y = all_words, color = abs(all_words - book_words))) +
geom_abline(color = "gray40", lty = 2) +
geom_jitter(alpha = 0.1, size = 2.5, width = 0.3, height = 0.3) +
geom_text(aes(label = word), check_overlap = TRUE, vjust = 1.5) +
scale_x_log10(labels = scales::percent_format()) +
scale_y_log10(labels = scales::percent_format()) +
scale_color_gradient(limits = c(0, 0.001), low = "darkslategray4", high = "gray75") +
facet_wrap(~ book) +
theme(legend.position="none") +
labs(y = "Harry Potter Series", x = NULL)
frequency %>%
split_by(book)
frequency %>%
split_by(~book)
?split_by
frequency %>%
split_by("book")
?split
frequency %>%
split(book)
frequency %>%
split(., book)
frequency %>%
split(., book)
frequency %>%
split(.$book)
frequency %>%
split(.$book) %>%
map(~cor.test(~ book_words + all_words))
frequency %>%
split(.$book) %>%
map(~cor.test(book_words + all_words))
frequency %>%
split(.$book) %>%
map(cor.test(book_words + all_words))
frequency %>%
split(.$book) %>%
map(cor.test(~book_words + all_words))
frequency %>%
split(.$book)
frequency %>%
group_by(book) %>%
mutate(correlation = cor(book_words, all_words))
frequency %>%
group_by(book) %>%
summarize(correlation = cor(book_words, all_words))
cor.test(frequency$book_words, frequency$all_words)
str(cor.test(frequency$book_words, frequency$all_words))
cor.test(frequency$book_words, frequency$all_words)$p.value
frequency %>%
group_by(book) %>%
summarize(correlation = cor(book_words, all_words),
p_value = cor.test(book_words, all_words)$p.value)
summarize(correlation = cor(book_words + all_words),
frequency %>%
group_by(book) %>%
summarize(correlation = cor(book_words, all_words),
p_value = cor.test(book_words + all_words)$p.value)
frequency %>%
group_by(book) %>%
summarize(correlation = cor(book_words, all_words),
p_value = cor.test(~book_words + all_words)$p.value)
frequency %>%
group_by(book) %>%
summarize(correlation = cor(book_words, all_words),
p_value = cor.test(book_words, all_words)$p.value)
frequency %>%
group_by(book) %>%
summarize(correlation = cor(book_words, all_words),
p_value = cor.test(book_words, all_words)$p.value)
?ggplot2::labs()
library(tidyverse)
?labs
sentiments
library(tidyverse)      # data manipulation & plotting
library(stringr)        # text cleaning and regular expressions
library(tidytext)       # provides additional text mining functions
library(harrypotter)    # provides the first seven novels of the Harry Potter series
sentiments
sentiments
sentiments
titles <- c("Philosopher's Stone", "Chamber of Secrets", "Prisoner of Azkaban",
"Goblet of Fire", "Order of the Phoenix", "Half-Blood Prince",
"Deathly Hallows")
books <- list(philosophers_stone, chamber_of_secrets, prisoner_of_azkaban,
goblet_of_fire, order_of_the_phoenix, half_blood_prince,
deathly_hallows)
series <- tibble()
for(i in seq_along(titles)) {
clean <- tibble(chapter = seq_along(books[[i]]),
text = books[[i]]) %>%
unnest_tokens(word, text) %>%
mutate(book = titles[i]) %>%
select(book, everything())
series <- rbind(series, clean)
}
# set factor to keep books in order of publication
series$book <- factor(series$book, levels = rev(titles))
series
series
series %>%
semi_join(get_sentiments("nrc")) %>%
count(word, sort = TRUE)
series %>%
semi_join(get_sentiments("nrc")) %>%
count(word, sort = TRUE)
series %>%
inner_join(get_sentiments("nrc")) %>%
count(word, sort = TRUE)
series %>%
right_join(get_sentiments("nrc")) %>%
count(word, sort = TRUE)
series %>%
left_join(get_sentiments("nrc")) %>%
count(word, sort = TRUE)
get_sentiments("nrc")
series
series %>% left_join(get_sentiments("nrc"))
series %>% left_join(get_sentiments("nrc")) %>% count(sentiment, sort = TRUE)
series %>%
right_join(get_sentiments("nrc")) %>%
filter(!is.na(sentiment)) %>%
count(sentiment, sort = TRUE)
series %>%
mutate(page = row_number(word) %/% 250)
series %>%
mutate(page = row_number(word) %/% 250)
row_number(series$word)
?row_number
series %>%
mutate(page = n() %/% 250)
series %>%
mutate(page = 1:n() %/% 250)
series %>%
mutate(page = 1:n() %/% 250) %>% filter(page == 10)
series %>%
group_by(book) %>%
mutate(page = n())
series %>%
group_by(book) %>%
mutate(page = n())
series %>%
group_by(book) %>%
mutate(page = 1:n())
series %>%
group_by(book) %>%
mutate(page = 1:n() %/% 250)
series %>%
group_by(book) %>%
mutate(page = 1:n() %/% 250) %>% filter(page > 0)
series %>%
group_by(book) %>%
mutate(page = 1:n() %/% 250) %>% View()
series %>%
group_by(book) %>%
mutate(page = 1:n() %/% 250 + 1) %>% View()
series %>%
group_by(book) %>%
mutate(page = n()) %>%
left_join(get_sentiments("bing"))
series %>%
group_by(book) %>%
mutate(page = n()) %>%
inner_join(get_sentiments("bing"))
series %>%
group_by(book) %>%
mutate(page = n()) %>%
inner_join(get_sentiments("bing")) %>%
count(book, page, sentiment)
series %>%
group_by(book) %>%
mutate(page = n()) %>%
inner_join(get_sentiments("bing")) %>%
count(book, page, sentiment) %>% arrange(page)
series %>%
group_by(book) %>%
mutate(page = n()) %>%
inner_join(get_sentiments("bing")) %>% group_by(page) %>%
count(book, page, sentiment) %>% arrange(page)
library(tidyverse)      # data manipulation & plotting
library(stringr)        # text cleaning and regular expressions
library(tidytext)       # provides additional text mining functions
library(harrypotter)    # provides the first seven novels of the Harry Potter series
?count
titles <- c("Philosopher's Stone", "Chamber of Secrets", "Prisoner of Azkaban",
"Goblet of Fire", "Order of the Phoenix", "Half-Blood Prince",
"Deathly Hallows")
books <- list(philosophers_stone, chamber_of_secrets, prisoner_of_azkaban,
goblet_of_fire, order_of_the_phoenix, half_blood_prince,
deathly_hallows)
series <- tibble()
for(i in seq_along(titles)) {
clean <- tibble(chapter = seq_along(books[[i]]),
text = books[[i]]) %>%
unnest_tokens(word, text) %>%
mutate(book = titles[i]) %>%
select(book, everything())
series <- rbind(series, clean)
}
# set factor to keep books in order of publication
series$book <- factor(series$book, levels = rev(titles))
series
series %>%
group_by(book) %>%
mutate(page = n()) %>%
left_join(get_sentiments("bing")) %>%
count(book, index = page, sentiment)
series %>%
group_by(book) %>%
mutate(page = n()) %>%
left_join(get_sentiments("bing")) %>%
count(book, index = page, sentiment)
series %>%
group_by(book) %>%
mutate(page = n()) %>%
left_join(get_sentiments("bing")) %>%
count(book, wt = page, sentiment)
series %>%
group_by(book) %>%
mutate(page = n()) %>%
left_join(get_sentiments("bing")) %>% group_by(page) %>%
count(book, sentiment)
series %>%
group_by(book) %>%
mutate(page = n()) %>%
left_join(get_sentiments("bing")) %>% group_by(page) %>%
count(book, sentiment) %>% arrange(page)
series %>%
inner_join(get_sentiments("bing"))
series %>%
inner_join(get_sentiments("bing")) %>% count(book, wt = sentiment)
series %>%
inner_join(get_sentiments("bing")) %>% count(book, sentiment)
series %>%
inner_join(get_sentiments("bing")) %>% count(book, chapter, sentiment)
series %>%
group_by(book) %>% mutate(1:n())
series %>%
group_by(book) %>% mutate(word_count = 1:n())
series %>%
group_by(book) %>% mutate(word_count = 1:n()) %>% filter(chapter > 2)
series %>%
group_by(book) %>% mutate(word_count = 1:n()) %>% filter(chapter > 1)
series %>%
group_by(book) %>% mutate(word_count = 1:n()) %>% filter(chapter == 1)
series %>%
group_by(book) %>% mutate(word_count = 1:n()) %>% filter(chapter == 1, book == "Chamber of Secrets")
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
page = word_count %/% page) %>%
inner_join(get_sentiments("bing")) %>%
count(book, index = page , sentiment)
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
page = word_count %/% page) %>%
inner_join(get_sentiments("bing")) %>%
count(book, page , sentiment)
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
page = word_count %/% page) %>%
inner_join(get_sentiments("bing"))
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
page = word_count %/% 250) %>%
inner_join(get_sentiments("bing")) %>%
count(book, index = page , sentiment)
1 %/% 250
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
page = word_count %/% 250 + 1) %>%
inner_join(get_sentiments("bing")) %>%
count(book, index = page , sentiment)
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
page = word_count %/% 250 + 1) %>%
inner_join(get_sentiments("bing")) %>%
count(book, index = page , sentiment) %>%
ungroup() %>%
mutate(book = factor(book, levels = titles))
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
page = word_count %/% 250 + 1) %>%
inner_join(get_sentiments("bing")) %>%
count(book, index = page , sentiment) %>%
ggplot(book_sentiment, aes(index, sentiment, fill = book)) +
geom_bar(alpha = 0.5, stat = "identity", show.legend = FALSE) +
facet_wrap(~ book, ncol = 2, scales = "free_x")
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
page = word_count %/% 250 + 1) %>%
inner_join(get_sentiments("bing")) %>%
count(book, index = page , sentiment) %>%
ggplot(aes(index, sentiment, fill = book)) +
geom_bar(alpha = 0.5, stat = "identity", show.legend = FALSE) +
facet_wrap(~ book, ncol = 2, scales = "free_x")
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
page = word_count %/% 250 + 1) %>%
inner_join(get_sentiments("bing")) %>%
count(book, index = page , sentiment)
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
page = word_count %/% 250 + 1) %>%
inner_join(get_sentiments("bing")) %>%
count(book, index = page , sentiment) %>%
ungroup() %>%
spread(sentiment, n, fill = 0) %>%
mutate(sentiment = positive - negative,
book = factor(book, levels = titles))
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
page = word_count %/% 250 + 1) %>%
inner_join(get_sentiments("bing")) %>%
count(book, index = page , sentiment) %>%
ungroup() %>%
spread(sentiment, n, fill = 0) %>%
mutate(sentiment = positive - negative,
book = factor(book, levels = titles)) %>%
ggplot(aes(index, sentiment, fill = book)) +
geom_bar(alpha = 0.5, stat = "identity", show.legend = FALSE) +
facet_wrap(~ book, ncol = 2, scales = "free_x")
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
page = word_count %/% 500 + 1) %>%
inner_join(get_sentiments("bing")) %>%
count(book, index = page , sentiment) %>%
ungroup() %>%
spread(sentiment, n, fill = 0) %>%
mutate(sentiment = positive - negative,
book = factor(book, levels = titles)) %>%
ggplot(aes(index, sentiment, fill = book)) +
geom_bar(alpha = 0.5, stat = "identity", show.legend = FALSE) +
facet_wrap(~ book, ncol = 2, scales = "free_x")
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
page = word_count %/% 500 + 1) %>%
inner_join(get_sentiments("bing"))
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
index = word_count %/% 500 + 1) %>%
inner_join(get_sentiments("bing")) %>%
count(book, index = index , sentiment) %>%
ungroup() %>%
spread(sentiment, n, fill = 0) %>%
mutate(sentiment = positive - negative,
book = factor(book, levels = titles)) %>%
ggplot(aes(index, sentiment, fill = book)) +
geom_bar(alpha = 0.5, stat = "identity", show.legend = FALSE) +
facet_wrap(~ book, ncol = 2, scales = "free_x")
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
index = word_count %/% 500 + 1) %>%
inner_join(get_sentiments("afinn")) %>%
group_by(index) %>%
summarise(sentiment = sum(score)) %>%
mutate(method = "AFINN")
series %>%
group_by(book) %>%
mutate(word_count = 1:n(),
index = word_count %/% 500 + 1) %>%
inner_join(get_sentiments("afinn")) %>%
group_by(book, index) %>%
summarise(sentiment = sum(score)) %>%
mutate(method = "AFINN")
